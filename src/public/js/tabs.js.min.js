let el=document.querySelector(".chrome-tabs"),chromeTabs=new ChromeTabs,tabs=[],deletedTabs=[];function showIframe(e){document.querySelector(`[data-iframe-id="${e}"]`).classList.remove("dnone")}function getCurrentTab(){return chromeTabs.activeTabEl.getAttribute("data-tab-id")}function hideIframe(e){let t;if(e)t=e;else try{t=chromeTabs.activeTabEl.getAttribute("data-tab-id")}catch(e){t=null}if(null!=t){let e;try{e=document.querySelector(`[data-iframe-id="${t}"]`)}catch(t){e=null}null!=e&&e.classList.add("dnone")}}function tabAdded(e){let t=tabs.length+deletedTabs.length;console.log(t),e.tabEl.setAttribute("data-tab-id",t),tabs.push({id:t,title:"Search",favicon:"favicon.ico"}),hideIframe()}function tabRemoved(e){let t=e.tabEl.getAttribute("data-tab-id");tabs=tabs.filter((e=>e.id!=t));let a=document.querySelector(`[data-iframe-id="${t}"]`);a&&a.remove(),deletedTabs.push(t)}function handoffToTABS(e){let t=chromeTabs.activeTabEl.getAttribute("data-tab-id"),a=document.querySelector(`[data-iframe-id="${t}"]`);a&&a.remove();let i=document.createElement("iframe");i.setAttribute("src",e),i.setAttribute("id","iframe");let o=chromeTabs.activeTabEl.getAttribute("data-tab-id");i.setAttribute("data-iframe-id",o),document.body.appendChild(i),addRightClickToIframe(o),isIframeLoaded(),document.getElementById("uv-form").style.marginTop="20px",document.getElementById("omnibox").setAttribute("class","dnone"),document.getElementById("omnibox-list").innerHTML=""}function restoreTabs(){chromeTabs.removeTab(chromeTabs.activeTabEl);let e=localStorage.getItem("tabs");e=JSON.parse(e),e.forEach((e=>{chromeTabs.addTab({title:e.title,favicon:e.favicon})}));let t=localStorage.getItem("iframes");t=JSON.parse(t),t.forEach((e=>{let t=document.createElement("iframe");t.setAttribute("src",e.src),t.setAttribute("data-iframe-id",e.id),t.setAttribute("id","iframe"),t.classList.add("dnone"),document.body.appendChild(t),chromeTabs.addTab({title:"Search",favicon:"favicon.ico"}),chromeTabs.removeTab(chromeTabs.activeTabEl)}))}function tabKeybinds(){console.log("tab keybinds initalized"),document.addEventListener("keydown",(function(e){e.altKey&&"t"===e.key&&chromeTabs.addTab({title:"Search",favicon:"favicon.ico"}),e.altKey&&"w"===e.key&&chromeTabs.removeTab(chromeTabs.activeTabEl)}))}function updateTabDetail(e,t,a){let i=a||chromeTabs.activeTabEl.getAttribute("data-tab-id");const o=document.querySelector(`.chrome-tab[data-tab-id="${i}"] .chrome-tab-title`),c=document.querySelector(`.chrome-tab[data-tab-id="${i}"] .chrome-tab-favicon`);""!=e&&null!=e||(e="Search"),""!=t&&null!=t||(t="favicon.ico"),o&&c?(o.innerHTML=e,c.style.backgroundImage=`url(${t})`):console.log("tabTitle is null")}function init(){chromeTabs.removeTab(chromeTabs.activeTabEl),chromeTabs.addTab({title:"Search",favicon:"favicon.ico"})}chromeTabs.init(el),document.getElementById("add-tab").addEventListener("click",(function(e){chromeTabs.addTab({title:"Search",favicon:"favicon.ico"})})),el.addEventListener("tabAdd",(function({detail:e}){tabAdded(e)})),el.addEventListener("tabRemove",(function({detail:e}){tabRemoved(e)})),el.addEventListener("activeTabChange",(function({detail:e}){let t=e.tabEl.getAttribute("data-tab-id"),a=document.querySelector(`[data-iframe-id="${t}"]`);document.querySelectorAll("[data-iframe-id]").forEach((e=>{e.classList.add("dnone"),updateURLBar("")})),a&&(showIframe(t),updateURLBar(a.contentWindow.location.href),updateTabDetail(a.contentWindow.document.title,a.contentWindow.document.querySelector('link[rel="icon"]')?proxyOtherStuff(a.contentWindow.document.querySelector('link[rel="icon"]').href):"favicon.ico",t))})),init();