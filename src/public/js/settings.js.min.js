function bare(e){e.endsWith("/")||(e+="/"),e.startsWith("http://")||e.startsWith("https://")||"/bare/"===e||"/bare"===e||(e="https://"+e),"/bare/"!==e&&"/bare"!==e?fetch(e).then((function(t){if(200!==t.status)return!1;bareChange(e),localStorage.setItem("bare",e)})).catch((function(e){console.log("Fetch Error :-S",e),bareChange("/bare/")})):bareChange(e)}function setTitle(e){localStorage.setItem("title",e),document.title=e}function favicon(e){localStorage.setItem("favicon",e),document.getElementById("favicon").href=e}function theme(e){localStorage.setItem("theme",e),document.documentElement.className=e}function searchSettings(e){localStorage.setItem("searchEngine",e)}function proxyChange(e){const t=function(){localStorage.setItem("proxy",e)};"rammerhead"===e?notifyWithConfirm("Rammerhead","is a server based proxy so it MAY run slower, as well as breaking the URL bar of the browser. Are you sure you want to use Rammerhead?",t,(function(){setItems()})):t()}function aboutBlank(){window.location.replace("https://google.com");const e=window.open();e.document.body.style.margin="0",e.document.body.style.height="100vh";const t=e.document.createElement("iframe");t.style.border="none",t.style.width="100%",t.style.height="100%",t.style.margin="0";const o=window.location.href;t.src=o,e.document.body.appendChild(t)}function jsBLOB(){const e=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n        <style type="text/css">\n        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }\n        </style>\n        </head>\n        <body>\n        <iframe style="border: none; width: 100%; height: 100vh;" src="${window.location.href}"></iframe>\n        </body>\n        </html>\n    `;window.location.replace("https://google.com");const t=new Blob([e],{type:"text/html"}),o=URL.createObjectURL(t);window.open(o,"_blank")}function promptCloaking(){promptCloakingNotify(aboutBlank,jsBLOB)}function fullScreenChange(e){localStorage.setItem("fullScreen",e)}function setItems(){let e=document.getElementById("titleInput"),t=document.getElementById("faviconInput"),o=document.getElementById("themeSelect"),a=document.getElementById("searchInput"),n=document.getElementById("proxySelect"),r=document.getElementById("fullscreenSelect"),l=document.getElementById("wispInput"),s=document.getElementById("bareInput"),c=document.getElementById("transportSelect"),i=localStorage.getItem("title"),m=localStorage.getItem("favicon"),g=localStorage.getItem("theme"),p=localStorage.getItem("searchEngine"),u=localStorage.getItem("proxy"),d=localStorage.getItem("fullScreen"),h=localStorage.getItem("wispUrl"),f=localStorage.getItem("bare"),I=localStorage.getItem("transports");e.value=i,t.value=m,o.value=g,a.value=p,n.value=u,r.value=d,l.value=h,s.value=f,c.value=I,bareOrWisp(I),document.documentElement.className=localStorage.getItem("theme"),document.title=i,document.getElementById("favicon").href=m}function reset(){localStorage.clear(),bareChange(window.location.origin+"/bare/"),setTitle("Ruby"),favicon("/favicon.ico"),theme("default"),searchSettings("https://www.google.com/search?q=%s"),proxyChange("uv"),fullScreenChange("page"),setDefaultTransport(),setItems(),uninstallAllSW()}function exportSettings(){let e={title:localStorage.getItem("title"),favicon:localStorage.getItem("favicon"),theme:localStorage.getItem("theme"),search:localStorage.getItem("searchEngine"),proxy:localStorage.getItem("proxy"),fullscreen:localStorage.getItem("fullScreen"),bare:localStorage.getItem("bare"),password:localStorage.getItem("password"),transports:localStorage.getItem("transports"),wispUrl:localStorage.getItem("wispUrl")},t=document.createElement("a"),o=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=URL.createObjectURL(o);t.href=a,t.download="ruby_settings.json",t.click(),URL.revokeObjectURL(a),t.remove()}function importSettings(){let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=function(){let t=e.files[0],o=new FileReader;o.readAsText(t),o.onload=function(){let e=JSON.parse(o.result);localStorage.setItem("title",e.title),localStorage.setItem("favicon",e.favicon),localStorage.setItem("theme",e.theme),localStorage.setItem("searchEngine",e.search),localStorage.setItem("proxy",e.proxy),localStorage.setItem("fullScreen",e.fullscreen),localStorage.setItem("bare",e.bare),localStorage.setItem("password",e.password),localStorage.setItem("transports",e.transports),changeWisp(e.wispUrl),setItems(),console.log("Imported settings"),window.location.reload()}},e.click()}function importExportSettings(){settingsImportExportChoice(exportSettings,importSettings)}function password(){localStorage.getItem("password")?passwordIsThere():passwordPrompt()}function passwordKeybinds(){document.addEventListener("keydown",(function(e){e.altKey&&"l"===e.key&&passwordLock()})),console.log("Password Keybind initalized")}function changeWisp(e){e.startsWith("http://")?e=e.replace("http://","ws://"):e.startsWith("https://")&&(e=e.replace("https://","wss://")),localStorage.setItem("wispUrl",e),setTransports()}function transportChange(e){function t(){const e=localStorage.getItem("transports");setTransports(e),bareOrWisp(e),setItems()}return"epoxy"===e?notifyWithConfirm("Epoxy","is a less stable. Are you sure you want to use Epoxy?",(function(){localStorage.setItem("transports","epoxy"),setTransports("epoxy"),bareOrWisp("epoxy")}),t):"bare"===e?notifyWithConfirm("Bare","is a less secure option then the others. Are you sure you want to use Bare?",(function(){localStorage.setItem("transports","bare"),setTransports("bare"),bareOrWisp("bare")}),t):(localStorage.setItem("transports",e),setTransports(e),void bareOrWisp(e))}function bareOrWisp(e){const t=document.getElementsByClassName("wisp")[0],o=document.getElementsByClassName("bare")[0];"bare"===e?(t.classList.add("dnone"),o.classList.remove("dnone")):(o.classList.add("dnone"),t.classList.remove("dnone"))}function init(){let e=localStorage.getItem("init");null==e||"false"===e?(localStorage.setItem("init",!0),localStorage.setItem("title","Ruby"),localStorage.setItem("favicon","/favicon.ico"),localStorage.setItem("theme","default"),localStorage.setItem("searchEngine","https://www.google.com/search?q=%s"),localStorage.setItem("proxy","uv"),localStorage.setItem("bare",window.location.origin+"/bare/"),localStorage.setItem("fullScreen","page"),localStorage.setItem("transports","epoxy"),localStorage.setItem("wispUrl",("https:"===location.protocol?"wss":"ws")+"://"+location.host+"/wisp/"),setItems()):("false"===localStorage.getItem("unlocked")&&passwordLock(),setItems())}localforage.config({driver:localforage.INDEXEDDB,name:"Ruby",version:1,storeName:"ruby_config",description:"Ruby Config for things in sw"}),init();